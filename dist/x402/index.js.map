{"version":3,"sources":["../../src/x402/types.ts","../../src/x402/helpers.ts","../../src/x402/client.ts","../../src/x402/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import { z } from \"zod\";\n\nexport const X402_VERSION = 1;\nexport const HEADER_X402 = \"X-PAYMENT\";\nexport const HEADER_PAYMENT_RESPONSE = \"X-PAYMENT-RESPONSE\";\n\nexport const x402RequirementSchema = z.object({\n  scheme: z.string().min(1),\n  network: z.string().min(1),\n  maxAmountRequired: z.string().min(1),\n  asset: z.string().min(1),\n  payTo: z.string().min(1),\n  resource: z.string().optional(),\n  description: z.string().optional(),\n  mimeType: z.string().optional(),\n  outputSchema: z.unknown().optional(),\n  maxTimeoutSeconds: z.number().int().positive().optional(),\n  extra: z.record(z.string(), z.unknown()).nullable().optional(),\n});\n\nexport type X402Requirement = z.infer<typeof x402RequirementSchema>;\n\nexport const x402PaymentHeaderSchema = z.object({\n  x402Version: z.number().int().positive(),\n  scheme: z.string().min(1),\n  network: z.string().min(1),\n  correlationId: z.string().optional(),\n  payload: z.unknown(),\n});\n\nexport type X402PaymentHeader = z.infer<typeof x402PaymentHeaderSchema>;\n\nexport interface X402RequirementsResponse {\n  x402Version: number;\n  error?: string;\n  accepts: X402Requirement[];\n}\n\nexport interface X402PaymentAttempt {\n  type: \"x402\";\n  headerName: typeof HEADER_X402;\n  raw: string;\n  payload: X402PaymentHeader;\n}\n\nexport interface X402VerificationResult {\n  success: boolean;\n  metadata?: {\n    optionId: string;\n    verifier: string;\n    [key: string]: unknown;\n  };\n  failure?: {\n    reason: string;\n    code: string;\n  };\n  responseHeaders?: Record<string, string>;\n}\n\nexport interface X402FacilitatorConfig {\n  url: string;\n  verifyPath?: string;\n  settlePath?: string;\n  apiKeyHeader?: string;\n}\n\nexport interface CurrencySpec {\n  decimals: number;\n  symbol: string;\n  network: string;\n  assetAddress: string;\n}\n\nexport const SUPPORTED_CURRENCIES: Record<string, CurrencySpec> = {\n  USDC: {\n    decimals: 6,\n    symbol: \"USDC\",\n    network: \"base\",\n    assetAddress: \"0x833589fCD6eDb6E08f4c7C37b7b4c6e997E08A43\",\n  },\n};\n\nexport const DEFAULT_FACILITATOR: X402FacilitatorConfig = {\n  url: \"https://facilitator.x402.rs\",\n  verifyPath: \"/verify\",\n  settlePath: \"/settle\",\n  apiKeyHeader: \"Authorization\",\n};\n","import { z } from \"zod\";\nimport {\n  HEADER_X402,\n  HEADER_PAYMENT_RESPONSE,\n  X402_VERSION,\n  x402PaymentHeaderSchema,\n  x402RequirementSchema,\n  type X402PaymentAttempt,\n  type X402Requirement,\n  type X402VerificationResult,\n  type X402FacilitatorConfig,\n} from \"./types\";\n\nexport interface X402PaymentDefinition {\n  amount: string;\n  currency: { code: string; symbol: string; decimals: number };\n  asset: { symbol: string; network: string; address: string; decimals: number };\n  payTo: string;\n  resource?: string;\n  description?: string;\n  scheme: string;\n  network: string;\n  facilitator: X402FacilitatorConfig;\n  metadata?: Record<string, unknown>;\n}\n\nexport function createX402PaymentRequired(\n  definition: X402PaymentDefinition\n): Response {\n  const requirement = toX402Requirement(definition);\n\n  // Build full payment requirements response\n  const body = {\n    schemaVersion: 1,\n    message: definition.description ?? \"Payment required\",\n    resource: definition.resource,\n    accepts: [\n      {\n        id: \"x402\",\n        title: `Pay ${definition.amount} ${definition.currency.code}`,\n        description: definition.description,\n        amount: {\n          value: definition.amount,\n          currency: {\n            code: definition.currency.code,\n            symbol: definition.currency.symbol,\n            decimals: definition.currency.decimals,\n            kind: \"crypto\",\n          },\n        },\n        asset: {\n          symbol: definition.asset.symbol,\n          network: definition.asset.network,\n          address: definition.asset.address,\n          decimals: definition.asset.decimals,\n          standard: \"erc20\",\n        },\n        payTo: definition.payTo,\n        resource: definition.resource,\n        proof: {\n          mode: \"x402\",\n          scheme: definition.scheme,\n          network: definition.network,\n          version: X402_VERSION,\n          facilitator: definition.facilitator,\n          verifier: \"x402:facilitator\",\n        },\n      },\n    ],\n    metadata: definition.metadata ?? {},\n    x402: {\n      x402Version: X402_VERSION,\n      error: definition.description ?? \"Payment required\",\n      accepts: [requirement],\n    },\n  };\n\n  return new Response(JSON.stringify(body), {\n    status: 402,\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n  });\n}\n\nexport function extractX402Attempt(request: Request): X402PaymentAttempt | null {\n  const raw = request.headers.get(HEADER_X402);\n  if (!raw) {\n    return null;\n  }\n\n  try {\n    const payload = decodeJson(raw, x402PaymentHeaderSchema);\n    return {\n      type: \"x402\",\n      headerName: HEADER_X402,\n      raw,\n      payload,\n    };\n  } catch {\n    return null;\n  }\n}\n\nexport async function verifyX402Payment(\n  attempt: X402PaymentAttempt,\n  definition: X402PaymentDefinition,\n  options: {\n    settle?: boolean;\n    fetchImpl?: typeof fetch;\n    timeout?: number;\n  } = {}\n): Promise<X402VerificationResult> {\n  const fetchImpl = options.fetchImpl ?? fetch;\n  const timeout = options.timeout ?? 25000; // 25 second default timeout\n  const facilitator = definition.facilitator;\n\n  const verifierUrl = new URL(\n    facilitator.verifyPath ?? \"/verify\",\n    ensureTrailingSlash(facilitator.url)\n  ).toString();\n\n  const requirement = toX402Requirement(definition);\n  const headers = buildFacilitatorHeaders(facilitator);\n\n  try {\n    const verifyBody = {\n      x402Version: attempt.payload.x402Version,\n      paymentPayload: attempt.payload,\n      paymentRequirements: requirement,\n    };\n    console.log(\"[x402] Calling facilitator /verify\", {\n      url: verifierUrl,\n      fullBody: JSON.stringify(verifyBody, null, 2)\n    });\n    const verifyResponse = await Promise.race([\n      fetchImpl(verifierUrl, {\n        method: \"POST\",\n        headers,\n        body: JSON.stringify(verifyBody),\n      }),\n      new Promise<never>((_, reject) =>\n        setTimeout(() => reject(new Error(`Verification timeout after ${timeout}ms`)), timeout)\n      ),\n    ]);\n    console.log(\"[x402] Facilitator /verify response\", { status: verifyResponse.status });\n\n    if (!verifyResponse.ok) {\n      const errorText = await verifyResponse.text().catch(() => \"\");\n      console.error(\"[x402] Facilitator /verify error\", { status: verifyResponse.status, body: errorText });\n      return {\n        success: false,\n        failure: {\n          reason: `Facilitator verify request failed: ${verifyResponse.status}${errorText ? ` - ${errorText}` : \"\"}`,\n          code: \"verification_failed\",\n        },\n      };\n    }\n\n    const verifyPayload = (await verifyResponse.json()) as {\n      isValid: boolean;\n      invalidReason?: string | null;\n    };\n\n    if (!verifyPayload.isValid) {\n      return {\n        success: false,\n        failure: {\n          reason: verifyPayload.invalidReason ?? \"Facilitator verification failed\",\n          code: \"verification_failed\",\n        },\n      };\n    }\n\n    const responseHeaders: Record<string, string> = {};\n    if (options.settle) {\n      const settleUrl = new URL(\n        facilitator.settlePath ?? \"/settle\",\n        ensureTrailingSlash(facilitator.url)\n      ).toString();\n\n      try {\n        const settleBody = {\n          x402Version: attempt.payload.x402Version,\n          paymentPayload: attempt.payload,\n          paymentRequirements: requirement,\n        };\n        console.log(\"[x402] Calling facilitator /settle\", {\n          url: settleUrl,\n          bodyPreview: JSON.stringify(settleBody).substring(0, 300)\n        });\n        const settleResponse = await Promise.race([\n          fetchImpl(settleUrl, {\n            method: \"POST\",\n            headers,\n            body: JSON.stringify(settleBody),\n          }),\n          new Promise<never>((_, reject) =>\n            setTimeout(() => reject(new Error(`Settlement timeout after ${timeout}ms`)), timeout)\n          ),\n        ]);\n        console.log(\"[x402] Facilitator /settle response\", { status: settleResponse.status });\n\n        if (!settleResponse.ok) {\n          const errorText = await settleResponse.text().catch(() => \"\");\n          console.error(\"[x402] Facilitator /settle error\", { status: settleResponse.status, body: errorText });\n          return {\n            success: false,\n            failure: {\n              reason: `Facilitator settlement failed: ${settleResponse.status}${errorText ? ` - ${errorText}` : \"\"}`,\n              code: \"settlement_failed\",\n            },\n          };\n        }\n\n        const settlePayload = (await settleResponse.json()) as {\n          txHash?: string;\n          [key: string]: unknown;\n        };\n        console.log(\"[x402] Facilitator /settle success\", { txHash: settlePayload.txHash });\n        if (settlePayload.txHash) {\n          responseHeaders[HEADER_PAYMENT_RESPONSE] = JSON.stringify({\n            settled: true,\n            txHash: settlePayload.txHash,\n          });\n        }\n      } catch (error) {\n        console.error(\"[x402] Settlement exception\", { error: error instanceof Error ? error.message : String(error) });\n        return {\n          success: false,\n          failure: {\n            reason: error instanceof Error ? error.message : \"Settlement failed\",\n            code: \"settlement_failed\",\n          },\n        };\n      }\n    }\n\n    const result: X402VerificationResult = {\n      success: true,\n      metadata: {\n        optionId: \"x402\",\n        verifier: \"x402:facilitator\",\n        amount: definition.amount,\n        currency: definition.currency.code,\n        network: definition.network,\n      },\n    };\n\n    if (Object.keys(responseHeaders).length > 0) {\n      result.responseHeaders = responseHeaders;\n    }\n\n    return result;\n  } catch (error) {\n    return {\n      success: false,\n      failure: {\n        reason: error instanceof Error ? error.message : \"Unknown error\",\n        code: \"verification_failed\",\n      },\n    };\n  }\n}\n\nfunction toX402Requirement(definition: X402PaymentDefinition): X402Requirement {\n  const decimals = definition.asset.decimals;\n  const units = decimalToBaseUnits(definition.amount, decimals);\n\n  return x402RequirementSchema.parse({\n    scheme: definition.scheme,\n    network: definition.network,\n    maxAmountRequired: units,\n    asset: definition.asset.address,\n    payTo: definition.payTo,\n    resource: definition.resource,\n    description: definition.description,\n    mimeType: \"application/json\",\n    maxTimeoutSeconds: 900,\n    extra: {\n      symbol: definition.asset.symbol,\n      currencyCode: definition.currency.code,\n      decimals,\n    },\n  });\n}\n\nfunction decimalToBaseUnits(value: string, decimals: number): string {\n  const [whole, fraction = \"\"] = value.split(\".\");\n  const sanitizedFraction = fraction.slice(0, decimals);\n  const paddedFraction = sanitizedFraction.padEnd(decimals, \"0\");\n  const combined = `${whole}${paddedFraction}`.replace(/^0+/, \"\");\n  return combined.length > 0 ? combined : \"0\";\n}\n\nfunction decodeJson<T>(value: string, schema: z.ZodSchema<T>): T {\n  const base64 = normalizeBase64(value);\n  const json = Buffer.from(base64, \"base64\").toString(\"utf-8\");\n  const parsed = JSON.parse(json);\n  return schema.parse(parsed);\n}\n\nfunction normalizeBase64(input: string): string {\n  if (/^[A-Za-z0-9+/=]+$/.test(input)) {\n    return input;\n  }\n  const restored = input.replace(/-/g, \"+\").replace(/_/g, \"/\");\n  const paddingNeeded = (4 - (restored.length % 4)) % 4;\n  return restored + \"=\".repeat(paddingNeeded);\n}\n\nfunction buildFacilitatorHeaders(facilitator: X402FacilitatorConfig): Record<string, string> {\n  const headers: Record<string, string> = {\n    \"Content-Type\": \"application/json\",\n  };\n  if (facilitator.apiKeyHeader && process.env.X402_FACILITATOR_API_KEY) {\n    headers[facilitator.apiKeyHeader] = process.env.X402_FACILITATOR_API_KEY;\n  }\n  return headers;\n}\n\nfunction ensureTrailingSlash(url: string): string {\n  return url.endsWith(\"/\") ? url : `${url}/`;\n}\n\nexport const PAYMENT_HEADERS = [HEADER_X402, HEADER_PAYMENT_RESPONSE] as const;\n","import { createWalletClient, http, type Address, type PrivateKeyAccount, type WalletClient } from \"viem\";\nimport { privateKeyToAccount } from \"viem/accounts\";\nimport { baseSepolia } from \"viem/chains\";\n\nexport interface X402ClientConfig {\n  privateKey: `0x${string}`;\n  rpcUrl?: string;\n}\n\nexport interface X402PayRequest {\n  url: string;\n  method?: string;\n  body?: unknown;\n  headers?: Record<string, string>;\n}\n\nexport interface X402PayResult {\n  success: boolean;\n  response?: Response;\n  error?: string;\n  paymentDetails?: {\n    amount: string;\n    currency: string;\n    network: string;\n    signature: string;\n  };\n}\n\nexport class X402Client {\n  private account: PrivateKeyAccount;\n  private walletClient: ReturnType<typeof createWalletClient>;\n\n  constructor(config: X402ClientConfig) {\n    this.account = privateKeyToAccount(config.privateKey);\n\n    // Support both base and base-sepolia\n    const chain = baseSepolia;\n    this.walletClient = createWalletClient({\n      account: this.account,\n      chain,\n      transport: http(config.rpcUrl),\n    });\n  }\n\n  async pay(request: X402PayRequest): Promise<X402PayResult> {\n    try {\n      // Step 1: Make initial request to get 402 response\n      const initialResponse = await fetch(request.url, {\n        method: request.method ?? \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          ...request.headers,\n        },\n        ...(request.body ? { body: JSON.stringify(request.body) } : {}),\n      });\n\n      // If not 402, return the response directly\n      if (initialResponse.status !== 402) {\n        return {\n          success: initialResponse.ok,\n          response: initialResponse,\n        };\n      }\n\n      // Step 2: Parse payment requirements\n      const paymentRequirements = await initialResponse.json();\n      const x402Requirements = paymentRequirements.x402?.accepts?.[0];\n\n      if (!x402Requirements) {\n        return {\n          success: false,\n          error: \"No x402 payment requirements found in 402 response\",\n        };\n      }\n\n      // Step 3: Generate EIP-3009 authorization\n      const authorization = await this.signTransferAuthorization({\n        from: this.account.address,\n        to: x402Requirements.payTo as Address,\n        value: BigInt(x402Requirements.maxAmountRequired),\n        validAfter: BigInt(Math.floor(Date.now() / 1000)),\n        validBefore: BigInt(Math.floor(Date.now() / 1000) + 900), // 15 min\n        nonce: `0x${Array.from({ length: 32 }, () =>\n          Math.floor(Math.random() * 256).toString(16).padStart(2, '0')\n        ).join('')}` as `0x${string}`,\n        tokenAddress: x402Requirements.asset as Address,\n      });\n\n      // Step 4: Build X-PAYMENT header\n      const paymentProof = {\n        x402Version: 1,\n        scheme: x402Requirements.scheme,\n        network: x402Requirements.network,\n        correlationId: \"\",\n        payload: {\n          signature: authorization.signature,\n          authorization: {\n            from: authorization.from,\n            to: authorization.to,\n            value: authorization.value.toString(),\n            validAfter: authorization.validAfter.toString(),\n            validBefore: authorization.validBefore.toString(),\n            nonce: authorization.nonce,\n          },\n        },\n      };\n\n      const paymentHeader = Buffer.from(JSON.stringify(paymentProof)).toString(\"base64\");\n\n      // Step 5: Retry request with payment\n      const paidResponse = await fetch(request.url, {\n        method: request.method ?? \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"X-PAYMENT\": paymentHeader,\n          ...request.headers,\n        },\n        ...(request.body ? { body: JSON.stringify(request.body) } : {}),\n      });\n\n      return {\n        success: paidResponse.ok,\n        response: paidResponse,\n        paymentDetails: {\n          amount: x402Requirements.maxAmountRequired,\n          currency: x402Requirements.extra?.currencyCode ?? \"USDC\",\n          network: x402Requirements.network,\n          signature: authorization.signature,\n        },\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n      };\n    }\n  }\n\n  private async signTransferAuthorization(params: {\n    from: Address;\n    to: Address;\n    value: bigint;\n    validAfter: bigint;\n    validBefore: bigint;\n    nonce: `0x${string}`;\n    tokenAddress: Address;\n  }) {\n    if (!this.walletClient.chain) {\n      throw new Error(\"Wallet client chain not configured\");\n    }\n\n    const domain = {\n      name: \"USD Coin\",\n      version: \"2\",\n      chainId: this.walletClient.chain.id,\n      verifyingContract: params.tokenAddress,\n    };\n\n    const types = {\n      TransferWithAuthorization: [\n        { name: \"from\", type: \"address\" },\n        { name: \"to\", type: \"address\" },\n        { name: \"value\", type: \"uint256\" },\n        { name: \"validAfter\", type: \"uint256\" },\n        { name: \"validBefore\", type: \"uint256\" },\n        { name: \"nonce\", type: \"bytes32\" },\n      ],\n    };\n\n    const message = {\n      from: params.from,\n      to: params.to,\n      value: params.value,\n      validAfter: params.validAfter,\n      validBefore: params.validBefore,\n      nonce: params.nonce,\n    };\n\n    const signature = await this.walletClient.signTypedData({\n      account: this.account,\n      domain,\n      types,\n      primaryType: \"TransferWithAuthorization\",\n      message,\n    });\n\n    return {\n      signature,\n      from: params.from,\n      to: params.to,\n      value: params.value,\n      validAfter: params.validAfter,\n      validBefore: params.validBefore,\n      nonce: params.nonce,\n    };\n  }\n\n  getAddress(): Address {\n    return this.account.address;\n  }\n}\n\n// Helper function for quick testing\nexport async function payX402(config: {\n  privateKey: `0x${string}`;\n  url: string;\n  body?: unknown;\n  rpcUrl?: string;\n}): Promise<X402PayResult> {\n  const client = new X402Client({\n    privateKey: config.privateKey,\n    ...(config.rpcUrl ? { rpcUrl: config.rpcUrl } : {}),\n  });\n\n  return client.pay({\n    url: config.url,\n    body: config.body,\n  });\n}\n\nexport interface EIP3009Authorization {\n  from: Address;\n  to: Address;\n  value: bigint;\n  validAfter: bigint;\n  validBefore: bigint;\n  nonce: `0x${string}`;\n}\n\nexport interface X402BrowserClientConfig {\n  walletClient: WalletClient;\n  chainId: number;\n}\n\nexport class X402BrowserClient {\n  private walletClient: WalletClient;\n  private chainId: number;\n\n  constructor(config: X402BrowserClientConfig) {\n    this.walletClient = config.walletClient;\n    this.chainId = config.chainId;\n  }\n\n  async pay(request: X402PayRequest): Promise<X402PayResult> {\n    try {\n      const initialResponse = await fetch(request.url, {\n        method: request.method ?? \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          ...request.headers,\n        },\n        ...(request.body ? { body: JSON.stringify(request.body) } : {}),\n      });\n\n      if (initialResponse.status !== 402) {\n        return {\n          success: initialResponse.ok,\n          response: initialResponse,\n        };\n      }\n\n      const paymentRequirements = await initialResponse.json();\n      const x402Requirements = paymentRequirements.x402?.accepts?.[0];\n\n      if (!x402Requirements) {\n        return {\n          success: false,\n          error: \"No x402 payment requirements found in 402 response\",\n        };\n      }\n\n      const account = this.walletClient.account;\n      if (!account) {\n        return {\n          success: false,\n          error: \"No account connected to wallet\",\n        };\n      }\n\n      const authorization: EIP3009Authorization = {\n        from: account.address,\n        to: x402Requirements.payTo as Address,\n        value: BigInt(x402Requirements.maxAmountRequired),\n        validAfter: BigInt(Math.floor(Date.now() / 1000)),\n        validBefore: BigInt(Math.floor(Date.now() / 1000) + 900),\n        nonce: `0x${Array.from({ length: 32 }, () =>\n          Math.floor(Math.random() * 256).toString(16).padStart(2, '0')\n        ).join('')}` as `0x${string}`,\n      };\n\n      const signature = await this.signTransferAuthorization(\n        authorization,\n        x402Requirements.asset as Address\n      );\n\n      const paymentProof = {\n        x402Version: 1,\n        scheme: x402Requirements.scheme,\n        network: x402Requirements.network,\n        correlationId: \"\",\n        payload: {\n          signature,\n          authorization: {\n            from: authorization.from,\n            to: authorization.to,\n            value: authorization.value.toString(),\n            validAfter: authorization.validAfter.toString(),\n            validBefore: authorization.validBefore.toString(),\n            nonce: authorization.nonce,\n          },\n        },\n      };\n\n      const paymentHeader = btoa(JSON.stringify(paymentProof));\n\n      const paidResponse = await fetch(request.url, {\n        method: request.method ?? \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"X-PAYMENT\": paymentHeader,\n          ...request.headers,\n        },\n        ...(request.body ? { body: JSON.stringify(request.body) } : {}),\n      });\n\n      return {\n        success: paidResponse.ok,\n        response: paidResponse,\n        paymentDetails: {\n          amount: x402Requirements.maxAmountRequired,\n          currency: x402Requirements.extra?.currencyCode ?? \"USDC\",\n          network: x402Requirements.network,\n          signature,\n        },\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n      };\n    }\n  }\n\n  private async signTransferAuthorization(\n    authorization: EIP3009Authorization,\n    tokenAddress: Address\n  ): Promise<`0x${string}`> {\n    const account = this.walletClient.account;\n    if (!account) {\n      throw new Error(\"No account connected to wallet\");\n    }\n\n    const domain = {\n      name: \"USD Coin\",\n      version: \"2\",\n      chainId: this.chainId,\n      verifyingContract: tokenAddress,\n    };\n\n    const types = {\n      TransferWithAuthorization: [\n        { name: \"from\", type: \"address\" },\n        { name: \"to\", type: \"address\" },\n        { name: \"value\", type: \"uint256\" },\n        { name: \"validAfter\", type: \"uint256\" },\n        { name: \"validBefore\", type: \"uint256\" },\n        { name: \"nonce\", type: \"bytes32\" },\n      ],\n    };\n\n    const message = {\n      from: authorization.from,\n      to: authorization.to,\n      value: authorization.value,\n      validAfter: authorization.validAfter,\n      validBefore: authorization.validBefore,\n      nonce: authorization.nonce,\n    };\n\n    return await this.walletClient.signTypedData({\n      account,\n      domain,\n      types,\n      primaryType: \"TransferWithAuthorization\",\n      message,\n    });\n  }\n}\n\nexport async function payX402WithWallet(\n  walletClient: WalletClient,\n  chainId: number,\n  request: X402PayRequest\n): Promise<X402PayResult> {\n  const client = new X402BrowserClient({ walletClient, chainId });\n  return client.pay(request);\n}\n","import {\n  createX402PaymentRequired,\n  extractX402Attempt,\n  verifyX402Payment,\n  PAYMENT_HEADERS,\n  type X402PaymentDefinition,\n} from \"./helpers\";\nimport {\n  SUPPORTED_CURRENCIES,\n  DEFAULT_FACILITATOR,\n  type X402FacilitatorConfig,\n  type X402VerificationResult,\n  type CurrencySpec,\n} from \"./types\";\n\nexport interface DefineX402PaymentConfig {\n  amount: string | number;\n  payTo: string;\n  currency?: string;\n  message?: string;\n  resource?: string;\n  network?: string;\n  assetAddress?: string;\n  scheme?: \"exact\" | \"bounded\";\n  facilitator?: string | X402FacilitatorConfig;\n  metadata?: Record<string, unknown>;\n}\n\nexport interface X402Payment {\n  definition: X402PaymentDefinition;\n  metadata?: Record<string, unknown>;\n}\n\nexport interface RequireX402PaymentOptions {\n  settle?: boolean;\n  fetchImpl?: typeof fetch;\n  onFailure?: (result: X402VerificationResult) => Response;\n}\n\nexport interface RequireX402PaymentSuccess {\n  payment: {\n    optionId: string;\n    verifier: string;\n    amount: string;\n    currency: string;\n    network: string;\n  };\n  headers: Record<string, string>;\n  result: X402VerificationResult;\n}\n\nexport type RequireX402PaymentOutcome = Response | RequireX402PaymentSuccess;\n\nconst PAYMENT_CONTEXT_SYMBOL = Symbol.for(\"opentool.x402.context\");\n\nexport class X402PaymentRequiredError extends Error {\n  readonly response: Response;\n  readonly verification: X402VerificationResult | undefined;\n\n  constructor(response: Response, verification?: X402VerificationResult) {\n    super(\"X402 Payment required\");\n    this.name = \"X402PaymentRequiredError\";\n    this.response = response;\n    this.verification = verification;\n  }\n}\n\nexport type X402PaymentContext = RequireX402PaymentSuccess;\n\nfunction setPaymentContext(request: Request, context: X402PaymentContext): void {\n  try {\n    Object.defineProperty(request, PAYMENT_CONTEXT_SYMBOL, {\n      value: context,\n      configurable: true,\n      enumerable: false,\n      writable: true,\n    });\n  } catch {\n    (request as any)[PAYMENT_CONTEXT_SYMBOL] = context;\n  }\n}\n\nexport function getX402PaymentContext(\n  request: Request\n): X402PaymentContext | undefined {\n  return (request as any)[PAYMENT_CONTEXT_SYMBOL];\n}\n\nexport function defineX402Payment(config: DefineX402PaymentConfig): X402Payment {\n  const currencyCode = normalizeCurrency(config.currency);\n  const currencySpec = SUPPORTED_CURRENCIES[currencyCode];\n\n  if (!currencySpec) {\n    throw new Error(`Unsupported currency for x402 payments: ${currencyCode}`);\n  }\n\n  const network = config.network ?? currencySpec.network;\n  const assetAddress = config.assetAddress ?? currencySpec.assetAddress;\n\n  if (!network || !assetAddress) {\n    throw new Error(\n      \"x402 payments require a network and assetAddress; supply them or choose a supported currency.\"\n    );\n  }\n\n  const facilitator = resolveFacilitator(config.facilitator);\n  const value = toDecimalString(config.amount);\n\n  const definition: X402PaymentDefinition = {\n    amount: value,\n    currency: {\n      code: currencyCode,\n      symbol: currencySpec.symbol,\n      decimals: currencySpec.decimals,\n    },\n    asset: {\n      symbol: currencySpec.symbol,\n      network,\n      address: assetAddress,\n      decimals: currencySpec.decimals,\n    },\n    payTo: config.payTo,\n    scheme: config.scheme ?? \"exact\",\n    network,\n    facilitator,\n  };\n\n  if (config.resource) {\n    definition.resource = config.resource;\n  }\n  if (config.message) {\n    definition.description = config.message;\n  }\n  if (config.metadata) {\n    definition.metadata = config.metadata;\n  }\n\n  const baseMetadata: Record<string, unknown> = {\n    amountUSDC: currencyCode === \"USDC\" ? Number(value) : undefined,\n    facilitator: \"x402rs\",\n    network,\n  };\n\n  const metadata = config.metadata\n    ? { ...baseMetadata, ...config.metadata }\n    : baseMetadata;\n\n  return {\n    definition,\n    metadata,\n  };\n}\n\nexport async function requireX402Payment(\n  request: Request,\n  payment: X402Payment | X402PaymentDefinition,\n  options: RequireX402PaymentOptions = {}\n): Promise<RequireX402PaymentOutcome> {\n  const definition = isX402Payment(payment) ? payment.definition : payment;\n\n  const attempt = extractX402Attempt(request);\n  if (!attempt) {\n    const response = createX402PaymentRequired(definition);\n    throw new X402PaymentRequiredError(response);\n  }\n\n  const verifyOptions: Parameters<typeof verifyX402Payment>[2] = {\n    settle: options.settle !== undefined ? options.settle : true,\n  };\n  if (options.fetchImpl !== undefined) {\n    verifyOptions.fetchImpl = options.fetchImpl;\n  }\n\n  const verification = await verifyX402Payment(attempt, definition, verifyOptions);\n\n  if (!verification.success || !verification.metadata) {\n    if (options.onFailure) {\n      return options.onFailure(verification);\n    }\n    const response = createX402PaymentRequired(definition);\n    throw new X402PaymentRequiredError(response, verification);\n  }\n\n  return {\n    payment: verification.metadata as {\n      optionId: string;\n      verifier: string;\n      amount: string;\n      currency: string;\n      network: string;\n    },\n    headers: verification.responseHeaders ?? {},\n    result: verification,\n  };\n}\n\nexport function withX402Payment(\n  handler: (request: Request) => Promise<Response> | Response,\n  payment: X402Payment | X402PaymentDefinition,\n  options: RequireX402PaymentOptions = {}\n): (request: Request) => Promise<Response> {\n  return async (request: Request): Promise<Response> => {\n    const verification = await requireX402Payment(request, payment, options);\n    if (verification instanceof Response) {\n      return verification;\n    }\n\n    setPaymentContext(request, verification);\n\n    const response = await Promise.resolve(handler(request));\n    return applyPaymentHeaders(response, verification.headers);\n  };\n}\n\nfunction applyPaymentHeaders(\n  response: Response,\n  headers: Record<string, string>\n): Response {\n  const entries = Object.entries(headers ?? {});\n  if (entries.length === 0) {\n    return response;\n  }\n\n  let mutated = false;\n  const merged = new Headers(response.headers);\n  for (const [key, value] of entries) {\n    if (!merged.has(key)) {\n      merged.set(key, value);\n      mutated = true;\n    }\n  }\n\n  if (!mutated) {\n    return response;\n  }\n\n  return new Response(response.body, {\n    status: response.status,\n    statusText: response.statusText,\n    headers: merged,\n  });\n}\n\nfunction isX402Payment(value: unknown): value is X402Payment {\n  return (\n    !!value &&\n    typeof value === \"object\" &&\n    \"definition\" in value &&\n    (value as X402Payment).definition !== undefined\n  );\n}\n\nfunction resolveFacilitator(\n  value: string | X402FacilitatorConfig | undefined\n): X402FacilitatorConfig {\n  if (!value) {\n    return DEFAULT_FACILITATOR;\n  }\n  if (typeof value === \"string\") {\n    return { ...DEFAULT_FACILITATOR, url: value };\n  }\n  return value;\n}\n\nfunction normalizeCurrency(currency?: string): string {\n  return (currency ?? \"USDC\").toUpperCase();\n}\n\nfunction toDecimalString(value: string | number): string {\n  return typeof value === \"number\" ? value.toString() : value;\n}\n\nexport { PAYMENT_HEADERS };\nexport type { X402PaymentDefinition, X402VerificationResult, X402FacilitatorConfig, CurrencySpec };\nexport { SUPPORTED_CURRENCIES, DEFAULT_FACILITATOR };\nexport {\n  X402Client,\n  payX402,\n  X402BrowserClient,\n  payX402WithWallet,\n  type X402ClientConfig,\n  type X402PayRequest,\n  type X402PayResult,\n  type X402BrowserClientConfig,\n  type EIP3009Authorization,\n} from \"./client\";\n"]}